<!DOCTYPE html>
<html>
<head>
    <title>Shared Buffer</title>
</head>

<script type="text/javascript">
    getIdFromPath = function () {
        const pathComponents = window.location.pathname.split('/');
        return pathComponents[pathComponents.length - 1];
    };

    window.onload = function () {
        const service = new WebSocket("ws://" + window.location.host + "/buffer/read");
        const bufferContent = document.getElementById('buffer-textarea');
        service.onmessage = function (event) {
            console.log("get: " + event.data);
            const input = JSON.parse(event.data);
            console.log("parse: " + input.message);
            bufferContent.value = input.message;
        };
        service.onopen = function (event) {
            console.log(event);
            const payload = JSON.stringify({
                role: 'reader',
                buffer_id: getIdFromPath()
            });
            service.send(payload)
        };
        service.onclose = function () {
            console.log("closed");
        };
        service.onerror = function () {
            console.log("error");
        };
    }
</script>
<body>
<textarea id="buffer-textarea" rows="4" cols="50" readonly="true"></textarea>
</body>
</html>
